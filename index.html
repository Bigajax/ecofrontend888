<!DOCTYPE html>
<html lang="pt-BR" class="font-sans">
  <head>
    <meta charset="UTF-8" />

    <!-- Favicon e √≠cones -->
    <link rel="icon" type="image/x-icon" href="/favicon-512.ico" />
    <link rel="icon" type="image/webp" sizes="512x512" href="/images/ECOTOPIA.webp" />
    <link rel="apple-touch-icon" href="/images/ECOTOPIA.webp" />

    <!-- Viewport robusto p/ iOS + safe areas + evitar zoom em inputs -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no"
    />

    <!-- Apar√™ncia em apps m√≥veis -->
    <meta name="theme-color" content="#FAF9F7" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no" />

    <title>Ecotopia: medita√ß√£o, sono e aten√ß√£o plena</title>
    <meta name="description" content="Ecotopia - Seu companheiro para medita√ß√£o, sono de qualidade e aten√ß√£o plena. Transforme sua rotina com pr√°ticas guiadas e personalizadas." />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Ecotopia: medita√ß√£o, sono e aten√ß√£o plena" />
    <meta property="og:description" content="Seu companheiro para medita√ß√£o, sono de qualidade e aten√ß√£o plena. Transforme sua rotina com pr√°ticas guiadas." />
    <meta property="og:image" content="/images/ECOTOPIA.webp" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ecotopia: medita√ß√£o, sono e aten√ß√£o plena" />
    <meta name="twitter:description" content="Seu companheiro para medita√ß√£o, sono de qualidade e aten√ß√£o plena." />
    <meta name="twitter:image" content="/images/ECOTOPIA.webp" />

    <!-- Fontes Soft Minimal: Inter + Playfair Display -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Google Identity Services (One Tap) -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Helpers: --vh para 100vh e feature flag de backdrop-filter -->
    <script>
      (function () {
        function setVh() {
          var vh = (window.visualViewport ? window.visualViewport.height : window.innerHeight) * 0.01;
          document.documentElement.style.setProperty('--vh', vh + 'px');
        }
        setVh();
        window.addEventListener('resize', setVh, { passive: true });
        if (window.visualViewport) {
          window.visualViewport.addEventListener('resize', setVh, { passive: true });
        }
        var supportsBackdrop =
          (window.CSS && CSS.supports && CSS.supports('backdrop-filter', 'blur(1px)')) ||
          (window.CSS && CSS.supports && CSS.supports('-webkit-backdrop-filter', 'blur(1px)'));
        if (supportsBackdrop) document.documentElement.classList.add('supports-backdrop');
      })();
    </script>

    <!-- Pequeno reset para cores de fundo e altura m√≠nima -->
    <style>
      html, body, #root { height: 100%; }
      body {
        margin: 0;
        /* Soft Minimal: areia clara com orbs past√©is suaves */
        background:
          radial-gradient(680px 560px at 16% -12%, rgba(198, 169, 149, 0.04), transparent 58%),
          radial-gradient(540px 420px at 88% -6%, rgba(230, 235, 239, 0.035), transparent 62%),
          radial-gradient(720px 620px at 50% 120%, rgba(243, 238, 231, 0.03), transparent 70%),
          linear-gradient(180deg, #FAF9F7 0%, #F3EEE7 100%);
        color: #38322A; /* Terra √∫mida */
      }
      /* fallback p/ browsers sem svh: 100*var(--vh) */
      .min-h-viewport {
        min-height: calc(var(--vh, 1vh) * 100);
      }
    </style>
  </head>

  <body class="min-h-viewport">
    <div id="root">
      <!-- üõ°Ô∏è FALLBACK DE SEGURAN√áA: Mostrado se React n√£o montar em 10s -->
      <!-- Cr√≠tico para Safari Mobile que pode falhar ao carregar ap√≥s inatividade -->
      <div id="loading-fallback" style="
        display: flex;
        min-height: 100vh;
        width: 100%;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, #FAF9F7 0%, #F3EEE7 100%);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
        padding: 20px;
        box-sizing: border-box;
      ">
        <div style="text-align: center; max-width: 400px;">
          <!-- Spinner -->
          <div style="
            margin: 0 auto 24px;
            width: 48px;
            height: 48px;
            border: 4px solid #E2E8F0;
            border-top-color: #3B82F6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          "></div>

          <!-- Mensagem -->
          <p style="
            font-size: 16px;
            font-weight: 500;
            color: #475569;
            margin: 0 0 12px;
          ">Carregando Ecotopia...</p>

          <p id="fallback-message" style="
            font-size: 14px;
            color: #94A3B8;
            margin: 0;
          ">Aguarde um momento</p>
        </div>
      </div>
    </div>

    <!-- Anima√ß√£o do spinner -->
    <style>
      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* Ocultar fallback quando React montar */
      #root:not(:empty) #loading-fallback {
        display: none !important;
      }
    </style>

    <!-- Script de timeout de seguran√ßa -->
    <script>
      (function() {
        // üõ°Ô∏è PROTE√á√ÉO: Se ap√≥s 10s React n√£o montou, mostrar erro amig√°vel
        var startTime = Date.now();
        var fallbackShown = false;

        setTimeout(function() {
          var root = document.getElementById('root');
          var fallback = document.getElementById('loading-fallback');
          var fallbackMsg = document.getElementById('fallback-message');

          // Se root ainda vazio ou s√≥ com fallback, significa que React n√£o montou
          if (root && (root.children.length <= 1 || !root.textContent.trim().replace(/\s+/g, ''))) {
            fallbackShown = true;

            console.error('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            console.error('[index.html] ‚ö†Ô∏è FALLBACK DE SEGURAN√áA ATIVADO');
            console.error('[index.html] React n√£o montou ap√≥s 10s');
            console.error('[index.html] Mostrando tela de erro amig√°vel');
            console.error('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');

            if (fallback) {
              fallback.innerHTML = `
                <div style="text-align: center; max-width: 420px; padding: 32px; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                  <!-- √çcone de Erro -->
                  <div style="
                    width: 64px;
                    height: 64px;
                    margin: 0 auto 20px;
                    background: #FEE2E2;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 32px;
                  ">‚ö†Ô∏è</div>

                  <h1 style="
                    font-size: 20px;
                    font-weight: 600;
                    color: #1E293B;
                    margin: 0 0 12px;
                  ">Ops! Algo deu errado</h1>

                  <p style="
                    font-size: 14px;
                    color: #64748B;
                    line-height: 1.6;
                    margin: 0 0 24px;
                  ">
                    O aplicativo n√£o conseguiu carregar corretamente.
                    ${/safari/i.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent)
                      ? 'Isso pode acontecer no Safari ap√≥s inatividade.'
                      : 'Tente recarregar a p√°gina.'
                    }
                  </p>

                  <!-- Bot√µes -->
                  <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button onclick="window.location.reload()" style="
                      width: 100%;
                      padding: 14px 24px;
                      background: #3B82F6;
                      color: white;
                      border: none;
                      border-radius: 12px;
                      font-size: 15px;
                      font-weight: 600;
                      cursor: pointer;
                      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
                    ">üîÑ Recarregar P√°gina</button>

                    <button onclick="localStorage.clear(); sessionStorage.clear(); window.location.href = '/login';" style="
                      width: 100%;
                      padding: 14px 24px;
                      background: white;
                      color: #64748B;
                      border: 2px solid #E2E8F0;
                      border-radius: 12px;
                      font-size: 15px;
                      font-weight: 600;
                      cursor: pointer;
                    ">üè† Limpar e Ir para Login</button>
                  </div>

                  <p style="
                    font-size: 12px;
                    color: #94A3B8;
                    margin: 16px 0 0;
                  ">Tempo de espera: ${Math.round((Date.now() - startTime) / 1000)}s</p>
                </div>
              `;
            }
          }
        }, 10000); // 10 segundos

        // Listener de erros globais
        window.addEventListener('error', function(e) {
          console.error('[index.html] üö® Erro global capturado:', e.message, e.filename, e.lineno, e.colno);
        });

        window.addEventListener('unhandledrejection', function(e) {
          console.error('[index.html] üö® Promise rejection n√£o tratada:', e.reason);
        });
      })();
    </script>

    <script type="module" src="./src/main.tsx"></script>
  </body>
</html>
